---
git:
  depth: 1
sudo: true # can't use this due to git upgrade requirement

cache:
  directories:
  - node_modules

env:
 - NODE_VERSION="6" TEST_TYPE="lint"
 - NODE_VERSION="6" TEST_TYPE="test"
 - NODE_VERSION="5" TEST_TYPE="test"
 - NODE_VERSION="4" TEST_TYPE="test"

matrix:
  exclude:
  - os: linux

install:
 # install more modern make
 - wget http://ftp.gnu.org/gnu/make/make-4.2.tar.gz
 - tar xvf make-4.2.tar.gz
 - pushd make-4.2
 - ./configure
 - make
 - sudo make install
 - popd
 - /usr/local/bin/make -v

 # install latest git
 - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install git; fi
 - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./scripts/update-linux-git.sh; fi
 - git --version

 # install proper node version
 - rm -rf ~/.nvm
 - git clone https://github.com/creationix/nvm.git ~/.nvm
 - source ~/.nvm/nvm.sh
 - nvm install $NODE_VERSION
 - node --version
 - npm install -g npm@3
 - npm install

os:
 - linux
 - osx

script:
  - if [[ "$TEST_TYPE" = lint ]]; then make lint; fi
  - if [[ "$TEST_TYPE" = test ]]; then make test-ci; fi
